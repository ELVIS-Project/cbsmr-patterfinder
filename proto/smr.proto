syntax = "proto3";

package proto;

service Index {
    rpc IndexNotes (IndexRequest) returns (Notes);
    rpc IndexMeasures (IndexRequest) returns (Measures);
    rpc IndexVectorsCsv (IndexRequest) returns (VectorsCsv);
}
	
service Smr {
    rpc Search (Notes) returns (Occurrences);
    rpc AddPiece (AddPieceRequest) returns (AddPieceResponse);
}

message IndexRequest {
	enum Encoding {
		UNKNOWN = 0;
		BASE64 = 1;
		UTF8 = 2;
	}
	bytes symbolic_data = 1;
	Encoding encoding = 2;
}

message AddPieceRequest {
	uint32 id = 1;
	Notes notes = 2;
}

message AddPieceResponse {
	uint32 id = 1;
}

message Note {
		float onset = 1;
		float offset = 2;
		int32 pitch_b40 = 3;
		uint32 piece_idx = 6;
}

message Notes {
	repeated Note notes = 1;
}

message Vector {
	Note start = 1;
	Note end = 2;
}

message Measure {
		bytes symbolic_data = 1;
		uint32 number = 2;
		uint32 note_idx = 3;
}

message Measures {
	repeated Measure measures = 1;
}

message VectorsCsv {
	string csv = 1;
}

message Occurrence {
	uint32 pid = 1;
	repeated uint32 notes = 2;
}

message Occurrences {
	repeated Occurrence occurrences = 1;
}
